package com.mvc.controller;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;

import com.mvc.common.Verify;
import com.mvc.entity.Graduateinfo;
import com.mvc.entity.Opentopicinfo;
import com.mvc.service.GradeoneService;
import com.mvc.service.GradetwoService;
import com.mvc.service.GraduateinfoService;
import com.mvc.service.OpentopicinfoService;
import com.mvc.service.OpentopicscoreService;

/**
 * 学生操作---答辩信息模块控制器
 * 
 * @author Happy_Jqc@163.com
 *
 */

@Controller
@RequestMapping(value = "/user/rejoin/")
public class RejoinInfoController {
	
	@Autowired
	private OpentopicinfoService opiService;
	
	@Autowired
	private GraduateinfoService gdiService;
	
	@Autowired
	private OpentopicscoreService opiscoreService;
	
	@Autowired
	private GradeoneService gradeoneService;
	
	@Autowired
	private GradetwoService gradetwoService;
	
	/**
	 * 
	 * 进入答辩信息视图 
	 * @Description  
	 * @author Happy_Jqc@163.com
	 * @date 2014-10-1 下午08:13:21
	 * @return ModelAndView
	 */
	@RequestMapping(value="infoview.do")
	public ModelAndView infoView(){
		return new ModelAndView("user/rejoinInfo/rejoin-info");
	}
	
	/**
	 * 
	 * 进入答辩时间、地点视图 
	 * @Description  
	 * @author Happy_Jqc@163.com
	 * @date 2014-10-1 下午08:51:09
	 * @return ModelAndView
	 */
	@RequestMapping(value="timeplace.do")
	public ModelAndView timeplaceView(){
		return new ModelAndView("user/rejoinInfo/time-place");
	}
	
	/**
	 * 
	 * 获取答辩时间、地点信息 
	 * @Description  
	 * @author Happy_Jqc@163.com
	 * @date 2014-10-2 上午10:25:01
	 * @return ModelAndView
	 */
	@RequestMapping(value="gettpinfo.do")
	public ModelAndView getTPInfo(HttpServletRequest request, ModelMap modelMap){
		ModelAndView mav = new ModelAndView();
		String rejoin_type = request.getParameter("type");
		String userId = (String) request.getSession().getAttribute("user_id");
		
		System.out.println(rejoin_type+"-----type ---");
		
		if(!Verify.isEmpty(rejoin_type) && rejoin_type.equals("1")){
			Opentopicinfo opiInfo = opiService.getRecordByWhere("from Opentopicinfo where stuId ='" + userId + "'");
			if(!Verify.isEmpty(opiInfo)){
				modelMap.put("opiInfo", opiInfo);
			}else{
				request.setAttribute("message", "没有您的答辩时间、地点相关信息，请确认是否提交答辩申请或联系系部管理员！");
			}
			
			mav.setViewName("user/rejoinInfo/timeplace-open");
			
		}else if(!Verify.isEmpty(rejoin_type) && rejoin_type.equals("2")){
			Graduateinfo graduateinfo = gdiService.getRecordByWhere("from Graduateinfo where stuId ='" + userId + "'");
			if(!Verify.isEmpty(graduateinfo)){
				modelMap.put("graduateinfo", graduateinfo);
			}else{
				request.setAttribute("message", "没有您的答辩时间、地点相关信息，请确认是否提交答辩申请或联系系部管理员！");
			}
			mav.setViewName("user/rejoinInfo/timeplace-graduate");
		}
		return mav;
	}
	
	/**
	 * 
	 * TODO 
	 * @Description  
	 * @author Happy_Jqc@163.com
	 * @date 2014-10-1 下午08:53:09
	 * @return ModelAndView
	 */
	@RequestMapping(value="grade.do")
	public ModelAndView rejoinGradeView(){
		return new ModelAndView("user/rejoinInfo/rejoin-grade");
	}
	
	/**
	 * 
	 * TODO 
	 * @Description  
	 * @author Happy_Jqc@163.com
	 * @date 2014-10-1 下午08:54:04
	 * @return ModelAndView
	 */
	@RequestMapping(value="document.do")
	public ModelAndView rejoinDocView(){
		return new ModelAndView("user/rejoinInfo/rejoin-doc");
	}
}
