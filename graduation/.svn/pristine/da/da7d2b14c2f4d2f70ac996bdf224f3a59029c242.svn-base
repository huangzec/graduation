<%@page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@page import="com.mvc.entity.*, com.mvc.common.*" %>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>

<%
	List<Tbtopic> topicList = (List<Tbtopic>) request.getAttribute("topicList");
	Settime selectTime 	= (Settime) request.getAttribute("select-time");
 %>

<jsp:include page="../common/header.jsp" flush="true" />
<style type="text/css">
	.trClass{height:35px;}
</style>

<body>
<div class="navbar navbar-fixed-top">
	<jsp:include page="../common/top.jsp" flush="true" />
	<!-- /navbar-inner -->
</div> <!-- /navbar -->
<div id="content">
	<div class="container">
		<div class="row">
			<jsp:include page="../common/navmenu.jsp" flush="true" />
			<!-- /span3 -->
			<div class="span9">
				<h1 class="page-title">
					<i class="icon-bookmark"></i> 选择课题					
				</h1>
				<div class="widget">										
					<div class="widget-content">
						<i class="icon-star"></i> 选择时间：
						 <%=(Verify.isEmpty(selectTime) ? "<span class=\"label label-default\">非选择课题时间 ！</span>" : "【 <a href=\"javascript:;\" class=\"accordion-toggle title collapsed\" title=\"正在进行......\">" + selectTime.getStartTime() + " ~~~~ " + selectTime.getEndTime() + "</a> 】  <span class=\"label label-success\">正在进行中......</span>") %>
					</div> <!-- /widget-content -->					
				</div> <!-- /widget -->
				
				<div class="widget widget-table">										
					<div class="widget-header">
						<i class="icon-th-list"></i>
						<h3>课题列表</h3>
						<span style="float: right;margin-right: 10px;color: red;"><b><%=(Verify.isEmpty(request.getAttribute("message")) ? "" : request.getAttribute("message")) %></b></span>
					</div> <!-- /widget-header -->					
					<div class="widget-content">
						<form id="judge-form">
							<table class="table table-striped table-bordered">
								<thead>
									<tr>
										<td>#</td>
										<td>课题编号</td>
										<td>课题名称</td>
										<td>提交人</td>
										<td>课题完成人数</td>
										<td align="center">选择</td>
									</tr>
								</thead>
								<tbody>
									<% 
										if(!Verify.isEmpty(topicList) && !Verify.isEmpty(selectTime)) {
											for(int i = 0; !Verify.isEmpty(topicList) && i < topicList.size(); i ++) {
											Tbtopic tbtopic = topicList.get(i);
									%>
									<tr>
										<td><%=(i + 1) %></td>
										<td><%=tbtopic.getTopId() %></td>
										<td>
											<a href="javascript:;" class="name" tag="name<%=i %>" title="<%=tbtopic.getTopName() %>">
												<%=StringUtil.cutString(tbtopic.getTopName(), 20) %>
											</a>
										</td>
										<td>
											<a href="javascript:;" class="content" tec="content<%=i %>" title="<%=tbtopic.getTopCommitId() %>">
												<%=tbtopic.getTopCommitId() %>
											</a>
										</td>
										<td><%=tbtopic.getTopNumber() %></td>
										<td class="action-td">
											<%if(tbtopic.getTopNumber() > 1) {%>
												<a class="btn btn-success btn-small disabled">确认</a>
											<%}else{ %>
												<a class="btn btn-success btn-small" href="<%=basePath %>user/topic/intoWriteKnowing.do?id=<%=tbtopic.getTopId() %>" title="确认选择">确认</a>
											<%} %>					
										</td>
									</tr>
									<%
										if(!Verify.isEmpty(tbtopic.getSontopics()) && tbtopic.getSontopics().size() > 0) {
										
									 %>
									 <tr class="sontopicname<%=i %>" style="display: none;">
									 	<td colspan="7">
										 <table style="width: 100%;">
										 	<thead>
										 		<tr>
										 			<td colspan="7" style="text-align: center;">" <%=tbtopic.getTopName() %> " 　子课题信息</td>
										 		</tr>
										 		<tr>
										 			<td colspan="2" style="text-align: center;">#</td>
										 			<td colspan="4" style="text-align: center;">子课题名称</td>
										 			<td style="text-align: center;">选择</td>
										 		</tr>
										 	</thead>
										 	<tbody>
										 		<% for(int index = 0; index < tbtopic.getSontopics().size(); index ++) { 
										 			Sontopic sontopic = tbtopic.getSontopics().iterator().next();
										 		%>
										 		<tr>
										 			<td colspan="2" style="text-align: center;"><%=(index + 1) %></td>
										 			<td colspan="4" style="text-align: center;">
										 				<%=(Verify.isEmpty(sontopic.getStTec()) ? "暂无相关信息" : sontopic.getStTec()) %>
										 			</td>
										 			<td style="text-align: center;">
										 				<a class="btn btn-success btn-small" href="<%=basePath %>user/topic/intoWriteKnowing.do?id=<%=tbtopic.getTopId() %>" title="确认选择">确认</a>
										 			</td>
										 		</tr>
										 		<% } %>
										 	</tbody>
										 </table>
										 </td>
									 </tr>
									 <% } %>
									<% } %>
									<tr>
										<td colspan="7"><div style="float: right; margin-right: 20px;"><jsp:include page="../common/pagelist.jsp" flush="true" /></div></td>
									</tr>
									<% } if(Verify.isEmpty(topicList) || topicList.size() == 0) { %>
									<tr>
										<td colspan="7" style="color: red; text-align: center;">暂无相关记录</td>
									</tr>
									<% } %>
								</tbody>
							</table>
						</form>
					</div> <!-- /widget-content -->					
				</div>
			</div> <!-- /span9 -->
		</div> <!-- /row -->
	</div> <!-- /container -->
</div> <!-- /content -->
<div id="footer">
	<div class="container">				
		<hr />
		<jsp:include page="../common/footer.jsp" flush="true" />
	</div> <!-- /container -->
</div> <!-- /footer -->
<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="<%=basePath %>cscon/js/jquery-1.7.2.min.js"></script>
<script src="<%=basePath %>cscon/js/bootstrap.js"></script>
<script src="<%=basePath %>vendor/hhjslib/hhjslib.js"></script>
<script src="<%=basePath %>vendor/hhjslib/hhjslib.dialog.js"></script>
<script src="<%=basePath %>js/site-judge.js"></script>
</body>
</html>